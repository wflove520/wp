<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æˆ‘çš„ç®€æ˜“äº‘ç›˜</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>ğŸš€ æˆ‘çš„ç§äººå¿«ä¼ </h1>
    <input type="file" id="fileSelector">
    <button onclick="upload()">ä¸Šä¼ å¹¶è·å–é“¾æ¥</button>

    <div id="status"></div>
    <div id="result"></div>

    <script>
        // æ›¿æ¢ä¸ºä½ è‡ªå·±çš„ Supabase é…ç½®
        const SUPABASE_URL = 'ä½ çš„SUPABASE_URL';
        const SUPABASE_KEY = 'ä½ çš„SUPABASE_ANON_KEY';
        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        async function upload() {
            const fileInput = document.getElementById('fileSelector');
            const file = fileInput.files[0];
            if (!file) return alert('è¯·å…ˆé€‰æ‹©æ–‡ä»¶');

            document.getElementById('status').innerText = 'æ­£åœ¨ä¸Šä¼ ...';

            // 1. ä¸Šä¼ æ–‡ä»¶åˆ° Supabase Storage
            // è·¯å¾„æ ¼å¼ï¼šæ–‡ä»¶å_éšæœºæ•°
            const fileName = `${Date.now()}_${file.name}`;
            const { data, error } = await supabase.storage
                .from('files')
                .upload(fileName, file);

            if (error) {
                console.error(error);
                alert('ä¸Šä¼ å¤±è´¥');
                return;
            }

            // 2. è·å–å…¬å…±ä¸‹è½½é“¾æ¥
            const { data: urlData } = supabase.storage
                .from('files')
                .getPublicUrl(fileName);

            const downloadUrl = urlData.publicUrl;

            document.getElementById('status').innerText = 'ä¸Šä¼ æˆåŠŸï¼';
            document.getElementById('result').innerHTML = `
                <p>æ–‡ä»¶é“¾æ¥ï¼ˆæœ‰æ•ˆæœŸæ°¸ä¹…ï¼‰ï¼š</p>
                <input type="text" value="${downloadUrl}" id="linkBox" readonly>
                <button onclick="copyLink()">å¤åˆ¶</button>
            `;
        }

        function copyLink() {
            const copyText = document.getElementById("linkBox");
            copyText.select();
            document.execCommand("copy");
            alert("é“¾æ¥å·²å¤åˆ¶");
        }
    </script>
</body>
</html>
