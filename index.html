<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HF æé€Ÿäº‘ä¼ </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #f3f4f6; font-family: system-ui, -apple-system, sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); }
        .progress-ani { transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
    </style>
</head>
<body class="max-w-2xl mx-auto pb-10">

    <div class="sticky top-0 z-50 glass border-b border-gray-200 px-5 py-4 flex justify-between items-center">
        <div>
            <h1 class="text-xl font-bold text-gray-900">â˜ï¸ æˆ‘çš„äº‘æ–‡ä»¶</h1>
            <p class="text-[10px] text-gray-400 uppercase tracking-widest">Hugging Face Backend</p>
        </div>
        <button onclick="loadFileList()" class="p-2 hover:bg-gray-100 rounded-full transition">
            <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
        </button>
    </div>

    <div class="m-4 bg-white rounded-3xl p-8 shadow-sm border border-gray-100 text-center">
        <input type="file" id="filePicker" class="hidden" onchange="handleUpload()">
        <label for="filePicker" class="group cursor-pointer">
            <div class="w-20 h-20 bg-blue-50 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                <svg class="w-10 h-10 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M12 4v16m8-8H4" stroke-width="2" stroke-linecap="round"/></svg>
            </div>
            <h2 class="text-gray-700 font-bold">ç‚¹å‡»ä¸Šä¼ å¤§æ–‡ä»¶</h2>
            <p class="text-gray-400 text-sm mt-1">æ”¯æŒ 600MB+ æ–‡ä»¶ç›´ä¼ </p>
        </label>

        <div id="uploadBox" class="hidden mt-6">
            <div class="flex justify-between text-xs mb-2">
                <span id="uploadInfo" class="text-blue-600 font-medium">å‡†å¤‡ä¸Šä¼ ...</span>
                <span id="percentText" class="text-gray-400">0%</span>
            </div>
            <div class="w-full bg-gray-100 rounded-full h-2 overflow-hidden">
                <div id="progressBar" class="bg-blue-500 h-full w-0 progress-ani"></div>
            </div>
        </div>
    </div>

    <div class="mx-4 mb-4 flex items-center justify-between bg-blue-50 p-3 rounded-xl border border-blue-100">
        <span class="text-sm text-blue-700 font-medium italic">ğŸš€ å¼€å¯å›½å†…ä¸‹è½½åŠ é€Ÿ</span>
        <input type="checkbox" id="useMirror" checked class="w-5 h-5 accent-blue-600 cursor-pointer">
    </div>

    <div id="fileList" class="px-4 space-y-3">
        <div class="animate-pulse flex flex-col items-center py-20">
            <div class="h-10 w-10 bg-gray-200 rounded-full mb-4"></div>
            <div class="h-4 w-32 bg-gray-200 rounded"></div>
        </div>
    </div>

    <div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 glass px-6 py-3 rounded-full shadow-2xl text-sm font-bold text-gray-800 hidden z-50"></div>

    <script>
        // === é…ç½®ä¸­å¿ƒ ===
        const HF_USER = "best520";
        const HF_REPO = "my-storage";
        const HF_TOKEN = "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"; // é‡è¦ï¼šè¯·å¡«å…¥ä½ çš„ Write Token

        // === 1. åˆå§‹åŒ–åˆ—è¡¨ ===
        window.onload = loadFileList;

        async function loadFileList() {
            const listEl = document.getElementById('fileList');
            try {
                // è°ƒç”¨ HF API è·å–ä»“åº“æ–‡ä»¶æ ‘
                const res = await fetch(`https://huggingface.co/api/datasets/${HF_USER}/${HF_REPO}/tree/main`);
                if (!res.ok) throw new Error("æ— æ³•è¯»å–åˆ—è¡¨ï¼Œè¯·æ£€æŸ¥ Token æˆ–ä»“åº“æ˜¯å¦å…¬å¼€");
                const files = await res.json();

                // è¿‡æ»¤æ‰ç³»ç»Ÿæ–‡ä»¶ (.gitattributes)
                const validFiles = files.filter(f => f.type === 'file' && f.path !== '.gitattributes');

                if (validFiles.length === 0) {
                    listEl.innerHTML = `<div class="text-center py-20 text-gray-400 text-sm">ä»“åº“ç©ºç©ºå¦‚ä¹Ÿ</div>`;
                    return;
                }

                listEl.innerHTML = validFiles.map(file => {
                    const rawUrl = `https://huggingface.co/datasets/${HF_USER}/${HF_REPO}/resolve/main/${file.path}`;
                    const size = (file.size / 1024 / 1024).toFixed(2) + ' MB';
                    return `
                        <div class="bg-white p-5 rounded-3xl shadow-sm border border-gray-50 flex items-center justify-between">
                            <div class="flex-1 min-w-0 pr-4">
                                <h3 class="text-gray-800 font-bold text-sm truncate">${file.path}</h3>
                                <p class="text-[10px] text-gray-400 mt-1 uppercase tracking-tighter">${size}</p>
                            </div>
                            <button onclick="copyLink('${rawUrl}')" class="bg-blue-600 text-white px-5 py-2 rounded-xl text-xs font-bold hover:bg-blue-700 active:scale-95 transition shadow-lg shadow-blue-100">
                                åˆ†äº«
                            </button>
                        </div>
                    `;
                }).join('');
            } catch (err) {
                listEl.innerHTML = `<p class="text-red-500 text-center py-20 text-xs">${err.message}</p>`;
            }
        }

        // === 2. ä¸Šä¼ é€»è¾‘ (æ”¯æŒå¤§æ–‡ä»¶æµ) ===
        async function handleUpload() {
            const picker = document.getElementById('filePicker');
            const file = picker.files[0];
            if (!file) return;

            const box = document.getElementById('uploadBox');
            const bar = document.getElementById('progressBar');
            const info = document.getElementById('uploadInfo');
            const pct = document.getElementById('percentText');

            box.classList.remove('hidden');
            info.innerText = "æ­£åœ¨æ¨é€åˆ° Hugging Face...";

            try {
                // ä½¿ç”¨ XMLHttpRequest æ¥è·å–ä¸Šä¼ è¿›åº¦
                const xhr = new XMLHttpRequest();
                const uploadUrl = `https://huggingface.co/api/datasets/${HF_USER}/${HF_REPO}/upload/main/${file.name}`;
                
                xhr.open('POST', uploadUrl, true);
                xhr.setRequestHeader('Authorization', `Bearer ${HF_TOKEN}`);

                // è¿›åº¦ç›‘å¬
                xhr.upload.onprogress = (e) => {
                    if (e.lengthComputable) {
                        const progress = Math.round((e.loaded / e.total) * 100);
                        bar.style.width = progress + '%';
                        pct.innerText = progress + '%';
                    }
                };

                xhr.onload = () => {
                    if (xhr.status === 200 || xhr.status === 201) {
                        showToast("âœ… ä¸Šä¼ æˆåŠŸï¼");
                        setTimeout(() => {
                            box.classList.add('hidden');
                            loadFileList();
                        }, 1000);
                    } else {
                        alert("ä¸Šä¼ å¤±è´¥ï¼š" + xhr.responseText);
                    }
                };

                xhr.send(file);
            } catch (err) {
                alert("å‘ç”Ÿé”™è¯¯ï¼š" + err.message);
            }
        }

        // === 3. å¤åˆ¶é“¾æ¥ (åŒ…å«é•œåƒåŠ é€Ÿé€»è¾‘) ===
        function copyLink(url) {
            let finalUrl = url;
            // å¦‚æœå¼€å¯äº†åŠ é€Ÿï¼Œæ›¿æ¢åŸŸåä¸ºå›½å†…é•œåƒç«™
            if (document.getElementById('useMirror').checked) {
                finalUrl = url.replace('huggingface.co', 'hf-mirror.com');
            }

            const el = document.createElement('textarea');
            el.value = finalUrl;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
            showToast("ğŸ”— é“¾æ¥å·²å¤åˆ¶ï¼ˆå·²åŠ é€Ÿï¼‰");
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.classList.remove('hidden');
            setTimeout(() => t.classList.add('hidden'), 2500);
        }
    </script>
</body>
</html>
