<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æˆ‘çš„ç§äººäº‘ç›˜</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #f8fafc; font-family: sans-serif; }
        .mask-box { -webkit-text-security: disc; }
    </style>
</head>
<body class="max-w-md mx-auto min-h-screen p-4 flex flex-col items-center justify-center">

    <div class="bg-white rounded-3xl shadow-xl w-full p-6 space-y-6">
        
        <div class="text-center space-y-1">
            <h1 class="text-2xl font-extrabold text-slate-800">â˜ï¸ ç§æœ‰æé€Ÿå¿«ä¼ </h1>
            <p class="text-xs text-slate-400">å­˜å‚¨äº GitHub Releases Â· 2GB/æ–‡ä»¶ Â· å›½å†…ä¸é™é€Ÿ</p>
        </div>

        <div class="hidden">
            <input type="text" id="repo_path" value="wflove520/wp">
            <input type="text" id="gh_token" value="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">
        </div>

        <div class="border-2 border-dashed border-blue-200 bg-blue-50/50 rounded-2xl p-10 text-center hover:border-blue-500 hover:bg-blue-50 transition-all relative group cursor-pointer">
            <input type="file" id="fileInput" class="absolute inset-0 opacity-0 cursor-pointer z-10" onchange="handleUpload()">
            
            <div class="transform transition-transform group-hover:scale-110 duration-300 text-5xl mb-3">
                ğŸ“¤
            </div>
            <p id="statusMsg" class="text-slate-600 font-bold text-sm">ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</p>
            <p class="text-slate-400 text-xs mt-1">æ”¯æŒ 600MB+ å¤§æ–‡ä»¶ç›´ä¼ </p>
        </div>

        <div id="progressArea" class="hidden space-y-2">
            <div class="flex justify-between text-xs text-slate-500 font-medium">
                <span id="speed">æ­£åœ¨è¿æ¥...</span>
                <span id="percent">0%</span>
            </div>
            <div class="w-full bg-slate-100 rounded-full h-2.5 overflow-hidden">
                <div id="progressBar" class="bg-blue-600 h-full w-0 transition-all duration-200 shadow-[0_0_10px_rgba(37,99,235,0.5)]"></div>
            </div>
        </div>

        <div id="resultArea" class="hidden bg-green-50 p-4 rounded-xl border border-green-200 animate-fade-in">
            <div class="flex items-center gap-2 mb-2">
                <div class="bg-green-100 p-1 rounded-full text-green-600">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                </div>
                <p class="text-xs font-bold text-green-800">ä¸Šä¼ æˆåŠŸï¼åŠ é€Ÿé“¾æ¥å·²ç”Ÿæˆ</p>
            </div>
            
            <div class="flex gap-2">
                <input type="text" id="finalLink" readonly class="flex-1 bg-white p-2 text-xs rounded-lg border border-green-200 text-slate-600 outline-none focus:border-green-500">
                <button onclick="copyLink()" class="bg-green-600 text-white px-4 py-2 rounded-lg text-xs font-bold shadow-lg shadow-green-200 active:scale-95 transition-all">å¤åˆ¶</button>
            </div>
        </div>
    </div>

    <p class="fixed bottom-4 text-[10px] text-slate-300 text-center w-full">
        Current Repo: wflove520/wp (Private)
    </p>

    <script>
        async function handleUpload() {
            const file = document.getElementById('fileInput').files[0];
            // ç›´æ¥ä»éšè—è¾“å…¥æ¡†è¯»å–ä½ é¢„å¡«çš„ä¿¡æ¯
            const token = document.getElementById('gh_token').value.trim();
            const repo = document.getElementById('repo_path').value.trim();

            if (!file) return;

            // UI åˆ‡æ¢
            const status = document.getElementById('statusMsg');
            const pArea = document.getElementById('progressArea');
            const pBar = document.getElementById('progressBar');
            const resultArea = document.getElementById('resultArea');
            
            pArea.classList.remove('hidden');
            resultArea.classList.add('hidden');
            status.innerText = "æ­£åœ¨åˆ›å»ºäº‘ç«¯èŠ‚ç‚¹...";

            try {
                // 1. åˆ›å»º Release èŠ‚ç‚¹
                const tagName = 'file_' + Date.now();
                const createRes = await fetch(`https://api.github.com/repos/${repo}/releases`, {
                    method: 'POST',
                    headers: { 
                        'Authorization': `token ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        tag_name: tagName,
                        name: file.name,
                        body: `Uploaded via Web on ${new Date().toLocaleString()}`,
                        draft: false,
                        prerelease: false
                    })
                });

                if (createRes.status === 401) throw new Error("Token æ— æ•ˆæˆ–å·²è¿‡æœŸ");
                if (createRes.status === 404) throw new Error("æ‰¾ä¸åˆ°ä»“åº“ (è¯·æ£€æŸ¥ä»“åº“åæˆ–Tokenæƒé™)");
                if (!createRes.ok) throw new Error("åˆ›å»ºèŠ‚ç‚¹å¤±è´¥");

                const releaseData = await createRes.json();
                const uploadUrl = releaseData.upload_url.split('{')[0] + `?name=${encodeURIComponent(file.name)}`;

                // 2. ä¸Šä¼ æ–‡ä»¶
                status.innerText = "ğŸš€ æ­£åœ¨æé€Ÿä¸Šä¼ ...";
                const xhr = new XMLHttpRequest();
                xhr.open('POST', uploadUrl, true);
                xhr.setRequestHeader('Authorization', `token ${token}`);
                xhr.setRequestHeader('Content-Type', 'application/octet-stream');

                xhr.upload.onprogress = (e) => {
                    if (e.lengthComputable) {
                        const p = Math.round((e.loaded / e.total) * 100);
                        pBar.style.width = p + '%';
                        document.getElementById('percent').innerText = p + '%';
                        document.getElementById('speed').innerText = `å·²ä¼  ${(e.loaded/1024/1024).toFixed(1)} MB`;
                    }
                };

                xhr.onload = () => {
                    if (xhr.status === 201) {
                        status.innerText = "âœ… ä¸Šä¼ å®Œæˆ";
                        // ç”Ÿæˆ ghproxy åŠ é€Ÿé“¾æ¥
                        const rawUrl = `https://github.com/${repo}/releases/download/${tagName}/${encodeURIComponent(file.name)}`;
                        const fastUrl = `https://ghproxy.cn/${rawUrl}`;
                        
                        document.getElementById('finalLink').value = fastUrl;
                        resultArea.classList.remove('hidden');
                        pArea.classList.add('hidden');
                        
                        // æ¸…ç©ºæ–‡ä»¶æ¡†ï¼Œæ–¹ä¾¿ä¸‹æ¬¡ä¸Šä¼ 
                        document.getElementById('fileInput').value = '';
                    } else {
                        throw new Error("ä¸Šä¼ ä¸­æ–­: " + xhr.responseText);
                    }
                };

                xhr.onerror = () => { throw new Error("ç½‘ç»œè¿æ¥å¤±è´¥"); };
                xhr.send(file);

            } catch (err) {
                alert("âŒ é”™è¯¯: " + err.message);
                pArea.classList.add('hidden');
                status.innerText = "ç‚¹å‡»é‡è¯•";
            }
        }

        function copyLink() {
            const input = document.getElementById('finalLink');
            input.select();
            document.execCommand('copy');
            alert('å·²å¤åˆ¶åŠ é€Ÿé“¾æ¥ï¼');
        }
    </script>
</body>
</html>
